<?php declare(strict_types=1);

namespace Kensho\Chart\Tests\Unit\Candle;

use DomainException;
use Kensho\Chart\Candle\Candle;
use Kensho\Chart\Number;
use PHPUnit\Framework\Attributes\DataProvider;
use PHPUnit\Framework\TestCase;

final class CandleTest extends TestCase
{
    #[DataProvider('provideInvalidValues')]
    public function testInvalidValues(
        string $open,
        string $high,
        string $low,
        string $close,
        string $volume,
    ): void {
        $this->expectException(DomainException::class);

        $actual = new Candle(
            new Number($open),
            new Number($high),
            new Number($low),
            new Number($close),
            new Number($volume),
            new Number(0),
            new Number(0),
            new Number(0),
        );

        $this->assertInstanceOf(Candle::class, $actual);
    }

    #[DataProvider('provideValidValues')]
    public function testValidValues(
        string $open,
        string $high,
        string $low,
        string $close,
        string $volume,
    ): void {
        $actual = new Candle(
            new Number($open),
            new Number($high),
            new Number($low),
            new Number($close),
            new Number($volume),
            new Number(0),
            new Number(0),
            new Number(0),
        );

        $this->assertInstanceOf(Candle::class, $actual);
    }

    /**
     * @return array<string, array<string, string>>
     */
    public static function provideInvalidValues(): array
    {
        return [
            'Negative open price' => [
                'open'   => '-140.8900',
                'high'   =>  '142.4300',
                'low'    =>  '138.8100',
                'close'  =>  '141.8600',
                'volume' =>  '65799349',
            ],
            'Negative high price' => [
                'open'   =>  '143.1700',
                'high'   => '-144.2500',
                'low'    =>  '141.9000',
                'close'  =>  '143.9600',
                'volume' =>  '54105068',
            ],
            'Negative low price' => [
                'open'   =>  '143.1700',
                'high'   =>  '144.2500',
                'low'    => '-141.9000',
                'close'  =>  '143.9600',
                'volume' =>  '54105068',
            ],
            'High price lower than low price' => [
                'open'   =>  '143.1550',
                'high'   =>  '143.0800',
                'low'    =>  '147.2300',
                'close'  =>  '145.9300',
                'volume' =>  '70555843',
            ],
            'Negative close price' => [
                'open'   =>  '144.9550',
                'high'   =>  '145.5500',
                'low'    =>  '142.8500',
                'close'  => '-143.0000',
                'volume' =>  '64015274',
            ],
            'Negative volume' => [
                'open'   =>  '142.7000',
                'high'   =>  '144.3400',
                'low'    =>  '142.2800',
                'close'  =>  '144.2900',
                'volume' => '-65874459',
            ],
        ];
    }

    /**
     * @return array<string, array<string, string>>
     */
    public static function provideValidValues(): array
    {
        return [
            '2023-01-25' => [
                'open'   => '140.8900',
                'high'   => '142.4300',
                'low'    => '138.8100',
                'close'  => '141.8600',
                'volume' => '65799349',
            ],
            '2023-01-26' => [
                'open'   => '143.1700',
                'high'   => '144.2500',
                'low'    => '141.9000',
                'close'  => '143.9600',
                'volume' => '54105068',
            ],
            '2023-01-27' => [
                'open'   => '143.1550',
                'high'   => '147.2300',
                'low'    => '143.0800',
                'close'  => '145.9300',
                'volume' => '70555843',
            ],
            '2023-01-30' => [
                'open'   => '144.9550',
                'high'   => '145.5500',
                'low'    => '142.8500',
                'close'  => '143.0000',
                'volume' => '64015274',
            ],
            '2023-01-31' => [
                'open'   => '142.7000',
                'high'   => '144.3400',
                'low'    => '142.2800',
                'close'  => '144.2900',
                'volume' => '65874459',
            ],
            '2023-02-01' => [
                'open'   => '143.9700',
                'high'   => '146.6100',
                'low'    => '141.3200',
                'close'  => '145.4300',
                'volume' => '77663633',
            ],
            '2023-02-02' => [
                'open'   => '148.9000',
                'high'   => '151.1800',
                'low'    => '148.1700',
                'close'  => '150.8200',
                'volume' => '118338980',
            ],
            '2023-02-03' => [
                'open'   => '148.0300',
                'high'   => '157.3800',
                'low'    => '147.8300',
                'close'  => '154.5000',
                'volume' => '154357337',
            ],
            '2023-02-06' => [
                'open'   => '152.5750',
                'high'   => '153.1000',
                'low'    => '150.7800',
                'close'  => '151.7300',
                'volume' => '69858306',
            ],
            '2023-02-07' => [
                'open'   => '150.6400',
                'high'   => '155.2300',
                'low'    => '150.6400',
                'close'  => '154.6500',
                'volume' => '83322551',
            ],
            '2023-02-08' => [
                'open'   => '153.8800',
                'high'   => '154.5800',
                'low'    => '151.1680',
                'close'  => '151.9200',
                'volume' => '64120079',
            ],
            '2023-02-09' => [
                'open'   => '153.7750',
                'high'   => '154.3300',
                'low'    => '150.4200',
                'close'  => '150.8700',
                'volume' => '56007143',
            ],
            '2023-02-10' => [
                'open'   => '149.4600',
                'high'   => '151.3401',
                'low'    => '149.2200',
                'close'  => '151.0100',
                'volume' => '57450708',
            ],
            '2023-02-13' => [
                'open'   => '150.9520',
                'high'   => '154.2600',
                'low'    => '150.9200',
                'close'  => '153.8500',
                'volume' => '62199013',
            ],
            '2023-02-14' => [
                'open'   => '152.1200',
                'high'   => '153.7700',
                'low'    => '150.8600',
                'close'  => '153.2000',
                'volume' => '61707573',
            ],
            '2023-02-15' => [
                'open'   => '153.1100',
                'high'   => '155.5000',
                'low'    => '152.8800',
                'close'  => '155.3300',
                'volume' => '65669252',
            ],
            '2023-02-16' => [
                'open'   => '153.5100',
                'high'   => '156.3300',
                'low'    => '153.3475',
                'close'  => '153.7100',
                'volume' => '68167942',
            ],
            '2023-02-17' => [
                'open'   => '152.3500',
                'high'   => '153.0000',
                'low'    => '150.8500',
                'close'  => '152.5500',
                'volume' => '59144118',
            ],
            '2023-02-21' => [
                'open'   => '150.2000',
                'high'   => '151.3000',
                'low'    => '148.4050',
                'close'  => '148.4800',
                'volume' => '58867230',
            ],
            '2023-02-22' => [
                'open'   => '148.8700',
                'high'   => '149.9500',
                'low'    => '147.1600',
                'close'  => '148.9100',
                'volume' => '51011305',
            ],
            '2023-02-23' => [
                'open'   => '150.0900',
                'high'   => '150.3400',
                'low'    => '147.2400',
                'close'  => '149.4000',
                'volume' => '48394249',
            ],
            '2023-02-24' => [
                'open'   => '147.1100',
                'high'   => '147.1900',
                'low'    => '145.7202',
                'close'  => '146.7100',
                'volume' => '55469606',
            ],
            '2023-02-27' => [
                'open'   => '147.7100',
                'high'   => '149.1700',
                'low'    => '147.4500',
                'close'  => '147.9200',
                'volume' => '44998470',
            ],
            '2023-02-28' => [
                'open'   => '147.0500',
                'high'   => '149.0800',
                'low'    => '146.8300',
                'close'  => '147.4100',
                'volume' => '50546998',
            ],
            '2023-03-01' => [
                'open'   => '146.8300',
                'high'   => '147.2285',
                'low'    => '145.0100',
                'close'  => '145.3100',
                'volume' => '55478991',
            ],
            '2023-03-02' => [
                'open'   => '144.3800',
                'high'   => '146.7100',
                'low'    => '143.9000',
                'close'  => '145.9100',
                'volume' => '52279761',
            ],
            '2023-03-03' => [
                'open'   => '148.0450',
                'high'   => '151.1100',
                'low'    => '147.3300',
                'close'  => '151.0300',
                'volume' => '70732297',
            ],
            '2023-03-06' => [
                'open'   => '153.7850',
                'high'   => '156.3000',
                'low'    => '153.4600',
                'close'  => '153.8300',
                'volume' => '87558028',
            ],
            '2023-03-07' => [
                'open'   => '153.7000',
                'high'   => '154.0299',
                'low'    => '151.1300',
                'close'  => '151.6000',
                'volume' => '56182028',
            ],
            '2023-03-08' => [
                'open'   => '152.8100',
                'high'   => '153.4700',
                'low'    => '151.8300',
                'close'  => '152.8700',
                'volume' => '47204791',
            ],
            '2023-03-09' => [
                'open'   => '153.5590',
                'high'   => '154.5350',
                'low'    => '150.2250',
                'close'  => '150.5900',
                'volume' => '53833582',
            ],
            '2023-03-10' => [
                'open'   => '150.2100',
                'high'   => '150.9400',
                'low'    => '147.6096',
                'close'  => '148.5000',
                'volume' => '68572400',
            ],
            '2023-03-13' => [
                'open'   => '147.8050',
                'high'   => '153.1400',
                'low'    => '147.7000',
                'close'  => '150.4700',
                'volume' => '84457122',
            ],
            '2023-03-14' => [
                'open'   => '151.2800',
                'high'   => '153.4000',
                'low'    => '150.1000',
                'close'  => '152.5900',
                'volume' => '73695893',
            ],
            '2023-03-15' => [
                'open'   => '151.1900',
                'high'   => '153.2450',
                'low'    => '149.9200',
                'close'  => '152.9900',
                'volume' => '77167866',
            ],
            '2023-03-16' => [
                'open'   => '152.1600',
                'high'   => '156.4600',
                'low'    => '151.6400',
                'close'  => '155.8500',
                'volume' => '76254419',
            ],
            '2023-03-17' => [
                'open'   => '156.0800',
                'high'   => '156.7400',
                'low'    => '154.2800',
                'close'  => '155.0000',
                'volume' => '98944633',
            ],
            '2023-03-20' => [
                'open'   => '155.0700',
                'high'   => '157.8200',
                'low'    => '154.1500',
                'close'  => '157.4000',
                'volume' => '73641415',
            ],
            '2023-03-21' => [
                'open'   => '157.3200',
                'high'   => '159.4000',
                'low'    => '156.5400',
                'close'  => '159.2800',
                'volume' => '73938285',
            ],
            '2023-03-22' => [
                'open'   => '159.3000',
                'high'   => '162.1400',
                'low'    => '157.8100',
                'close'  => '157.8300',
                'volume' => '75701811',
            ],
            '2023-03-23' => [
                'open'   => '158.8300',
                'high'   => '161.5501',
                'low'    => '157.6800',
                'close'  => '158.9300',
                'volume' => '67622060',
            ],
            '2023-03-24' => [
                'open'   => '158.8600',
                'high'   => '160.3400',
                'low'    => '157.8500',
                'close'  => '160.2500',
                'volume' => '59256343',
            ],
            '2023-03-27' => [
                'open'   => '159.9400',
                'high'   => '160.7700',
                'low'    => '157.8700',
                'close'  => '158.2800',
                'volume' => '52390266',
            ],
            '2023-03-28' => [
                'open'   => '157.9700',
                'high'   => '158.4900',
                'low'    => '155.9800',
                'close'  => '157.6500',
                'volume' => '45992152',
            ],
            '2023-03-29' => [
                'open'   => '159.3700',
                'high'   => '161.0500',
                'low'    => '159.3500',
                'close'  => '160.7700',
                'volume' => '51305691',
            ],
            '2023-03-30' => [
                'open'   => '161.5300',
                'high'   => '162.4700',
                'low'    => '161.2710',
                'close'  => '162.3600',
                'volume' => '49501689',
            ],
            '2023-03-31' => [
                'open'   => '162.4400',
                'high'   => '165.0000',
                'low'    => '161.9100',
                'close'  => '164.9000',
                'volume' => '68749792',
            ],
            '2023-04-03' => [
                'open'   => '164.2700',
                'high'   => '166.2900',
                'low'    => '164.2200',
                'close'  => '166.1700',
                'volume' => '56976187',
            ],
            '2023-04-04' => [
                'open'   => '166.5950',
                'high'   => '166.8400',
                'low'    => '165.1100',
                'close'  => '165.6300',
                'volume' => '46278295',
            ],
            '2023-04-05' => [
                'open'   => '164.7400',
                'high'   => '165.0500',
                'low'    => '161.8000',
                'close'  => '163.7600',
                'volume' => '51511744',
            ],
            '2023-04-06' => [
                'open'   => '162.4300',
                'high'   => '164.9584',
                'low'    => '162.0000',
                'close'  => '164.6600',
                'volume' => '45390123',
            ],
            '2023-04-10' => [
                'open'   => '161.4200',
                'high'   => '162.0300',
                'low'    => '160.0800',
                'close'  => '162.0300',
                'volume' => '47716882',
            ],
            '2023-04-11' => [
                'open'   => '162.3500',
                'high'   => '162.3600',
                'low'    => '160.5100',
                'close'  => '160.8000',
                'volume' => '47644217',
            ],
            '2023-04-12' => [
                'open'   => '161.2200',
                'high'   => '162.0600',
                'low'    => '159.7800',
                'close'  => '160.1000',
                'volume' => '50133062',
            ],
            '2023-04-13' => [
                'open'   => '161.6300',
                'high'   => '165.8000',
                'low'    => '161.4200',
                'close'  => '165.5600',
                'volume' => '68445649',
            ],
            '2023-04-14' => [
                'open'   => '164.5900',
                'high'   => '166.3200',
                'low'    => '163.8200',
                'close'  => '165.2100',
                'volume' => '49386480',
            ],
            '2023-04-17' => [
                'open'   => '165.0900',
                'high'   => '165.3900',
                'low'    => '164.0300',
                'close'  => '165.2300',
                'volume' => '40713618',
            ],
            '2023-04-18' => [
                'open'   => '166.1000',
                'high'   => '167.4100',
                'low'    => '165.6500',
                'close'  => '166.4700',
                'volume' => '49923008',
            ],
            '2023-04-19' => [
                'open'   => '165.8000',
                'high'   => '168.1600',
                'low'    => '165.5400',
                'close'  => '167.6300',
                'volume' => '47720166',
            ],
            '2023-04-20' => [
                'open'   => '166.0900',
                'high'   => '167.8700',
                'low'    => '165.5600',
                'close'  => '166.6500',
                'volume' => '52456377',
            ],
            '2023-04-21' => [
                'open'   => '165.0500',
                'high'   => '166.4521',
                'low'    => '164.4900',
                'close'  => '165.0200',
                'volume' => '58337341',
            ],
            '2023-04-24' => [
                'open'   => '165.0000',
                'high'   => '165.6000',
                'low'    => '163.8900',
                'close'  => '165.3300',
                'volume' => '41949581',
            ],
            '2023-04-25' => [
                'open'   => '165.1900',
                'high'   => '166.3050',
                'low'    => '163.7300',
                'close'  => '163.7700',
                'volume' => '48714063',
            ],
            '2023-04-26' => [
                'open'   => '163.0550',
                'high'   => '165.2800',
                'low'    => '162.8000',
                'close'  => '163.7600',
                'volume' => '44105745',
            ],
            '2023-04-27' => [
                'open'   => '165.1900',
                'high'   => '168.5600',
                'low'    => '165.1900',
                'close'  => '168.4100',
                'volume' => '64902329',
            ],
            '2023-04-28' => [
                'open'   => '168.4900',
                'high'   => '169.8500',
                'low'    => '167.8801',
                'close'  => '169.6800',
                'volume' => '55275851',
            ],
            '2023-05-01' => [
                'open'   => '169.2800',
                'high'   => '170.4500',
                'low'    => '168.6400',
                'close'  => '169.5900',
                'volume' => '52472936',
            ],
            '2023-05-02' => [
                'open'   => '170.0900',
                'high'   => '170.3500',
                'low'    => '167.5400',
                'close'  => '168.5400',
                'volume' => '48425696',
            ],
            '2023-05-03' => [
                'open'   => '169.5000',
                'high'   => '170.9200',
                'low'    => '167.1600',
                'close'  => '167.4500',
                'volume' => '65136018',
            ],
            '2023-05-04' => [
                'open'   => '164.8900',
                'high'   => '167.0400',
                'low'    => '164.3100',
                'close'  => '165.7900',
                'volume' => '81235427',
            ],
            '2023-05-05' => [
                'open'   => '170.9750',
                'high'   => '174.3000',
                'low'    => '170.7600',
                'close'  => '173.5700',
                'volume' => '113453171',
            ],
            '2023-05-08' => [
                'open'   => '172.4800',
                'high'   => '173.8500',
                'low'    => '172.1100',
                'close'  => '173.5000',
                'volume' => '55962793',
            ],
            '2023-05-09' => [
                'open'   => '173.0500',
                'high'   => '173.5400',
                'low'    => '171.6000',
                'close'  => '171.7700',
                'volume' => '45326874',
            ],
            '2023-05-10' => [
                'open'   => '173.0200',
                'high'   => '174.0300',
                'low'    => '171.9000',
                'close'  => '173.5550',
                'volume' => '53724501',
            ],
            '2023-05-11' => [
                'open'   => '173.8500',
                'high'   => '174.5900',
                'low'    => '172.1700',
                'close'  => '173.7500',
                'volume' => '49514676',
            ],
            '2023-05-12' => [
                'open'   => '173.6200',
                'high'   => '174.0600',
                'low'    => '171.0000',
                'close'  => '172.5700',
                'volume' => '45533138',
            ],
            '2023-05-15' => [
                'open'   => '173.1600',
                'high'   => '173.2100',
                'low'    => '171.4700',
                'close'  => '172.0700',
                'volume' => '37266659',
            ],
            '2023-05-16' => [
                'open'   => '171.9900',
                'high'   => '173.1383',
                'low'    => '171.7991',
                'close'  => '172.0700',
                'volume' => '42110293',
            ],
            '2023-05-17' => [
                'open'   => '171.7100',
                'high'   => '172.9250',
                'low'    => '170.4201',
                'close'  => '172.6900',
                'volume' => '57951604',
            ],
            '2023-05-18' => [
                'open'   => '173.0000',
                'high'   => '175.2400',
                'low'    => '172.5800',
                'close'  => '175.0500',
                'volume' => '65496657',
            ],
            '2023-05-19' => [
                'open'   => '176.3900',
                'high'   => '176.3900',
                'low'    => '174.9400',
                'close'  => '175.1600',
                'volume' => '55809475',
            ],
            '2023-05-22' => [
                'open'   => '173.9800',
                'high'   => '174.7100',
                'low'    => '173.4500',
                'close'  => '174.2000',
                'volume' => '43570932',
            ],
            '2023-05-23' => [
                'open'   => '173.1300',
                'high'   => '173.3794',
                'low'    => '171.2750',
                'close'  => '171.5600',
                'volume' => '50747263',
            ],
            '2023-05-24' => [
                'open'   => '171.0900',
                'high'   => '172.4183',
                'low'    => '170.5200',
                'close'  => '171.8400',
                'volume' => '45143488',
            ],
            '2023-05-25' => [
                'open'   => '172.4100',
                'high'   => '173.8950',
                'low'    => '171.6900',
                'close'  => '172.9900',
                'volume' => '56058258',
            ],
            '2023-05-26' => [
                'open'   => '173.3200',
                'high'   => '175.7700',
                'low'    => '173.1100',
                'close'  => '175.4300',
                'volume' => '54834975',
            ],
            '2023-05-30' => [
                'open'   => '176.9600',
                'high'   => '178.9900',
                'low'    => '176.5700',
                'close'  => '177.3000',
                'volume' => '55964401',
            ],
            '2023-05-31' => [
                'open'   => '177.3250',
                'high'   => '179.3500',
                'low'    => '176.7600',
                'close'  => '177.2500',
                'volume' => '99313268',
            ],
            '2023-06-01' => [
                'open'   => '177.7000',
                'high'   => '180.1200',
                'low'    => '176.9306',
                'close'  => '180.0900',
                'volume' => '68901809',
            ],
            '2023-06-02' => [
                'open'   => '181.0300',
                'high'   => '181.7800',
                'low'    => '179.2600',
                'close'  => '180.9500',
                'volume' => '61996913',
            ],
            '2023-06-05' => [
                'open'   => '182.6300',
                'high'   => '184.9510',
                'low'    => '178.0350',
                'close'  => '179.5800',
                'volume' => '121946497',
            ],
            '2023-06-06' => [
                'open'   => '179.9650',
                'high'   => '180.1200',
                'low'    => '177.4300',
                'close'  => '179.2100',
                'volume' => '64848374',
            ],
            '2023-06-07' => [
                'open'   => '178.4400',
                'high'   => '181.2100',
                'low'    => '177.3200',
                'close'  => '177.8200',
                'volume' => '61944615',
            ],
            '2023-06-08' => [
                'open'   => '177.8950',
                'high'   => '180.8400',
                'low'    => '177.4600',
                'close'  => '180.5700',
                'volume' => '50214881',
            ],
            '2023-06-09' => [
                'open'   => '181.5000',
                'high'   => '182.2300',
                'low'    => '180.6300',
                'close'  => '180.9600',
                'volume' => '48899973',
            ],
            '2023-06-12' => [
                'open'   => '181.2700',
                'high'   => '183.8900',
                'low'    => '180.9700',
                'close'  => '183.7900',
                'volume' => '54754995',
            ],
            '2023-06-13' => [
                'open'   => '182.8000',
                'high'   => '184.1500',
                'low'    => '182.4400',
                'close'  => '183.3100',
                'volume' => '54929129',
            ],
            '2023-06-14' => [
                'open'   => '183.3700',
                'high'   => '184.3900',
                'low'    => '182.0200',
                'close'  => '183.9500',
                'volume' => '57462882',
            ],
            '2023-06-15' => [
                'open'   => '183.9600',
                'high'   => '186.5200',
                'low'    => '183.7800',
                'close'  => '186.0100',
                'volume' => '65433166',
            ],
            '2023-06-16' => [
                'open'   => '186.7300',
                'high'   => '186.9900',
                'low'    => '184.2700',
                'close'  => '184.9200',
                'volume' => '101256225',
            ],
        ];
    }
}
